Module lib_list_Perm Import "lib_list_Distin";
$[Perm : {s|SET}(list s)->(list s)->Prop//perm1 perm2];
$[perm1 : {s|SET}Perm%%s (nil s) (nil s)];
$[perm2 : {s|SET}{xs,ys:list s}(Perm%%s xs ys)->{a:s}{axs:list s}(Adjoin%%s a xs axs)->{ays:list s}(Adjoin%%s a ys ays)->Perm%%s axs ays];
$[Perm_elim : {s|SET}{C_Perm:{x1,x2:list s}Prop}(C_Perm (nil s) (nil s))->({xs,ys:list s}{x1:Perm%%s xs ys}{a:s}{axs:list s}{x2:Adjoin%%s a xs axs}{ays:list s}{x3:Adjoin%%s a ys ays}{x1_ih:C_Perm xs ys}C_Perm axs ays)->{x1,x2|list s}{z:Perm%%s x1 x2}C_Perm x1 x2];
Label (!Perm!) Perm;Label (!Perm elim!) Perm_elim;Label (!Perm perm1!) perm1;Label (!Perm perm2!) perm2;[[s|SET][C_Perm:(list s)->(list s)->Prop][f_perm1:C_Perm (nil s) (nil s)][f_perm2:{xs,ys:list s}(Perm xs ys)->{a:s}{axs:list s}(Adjoin a xs axs)->{ays:list s}(Adjoin a ys ays)->(C_Perm xs ys)->C_Perm axs ays][xs,ys:list s][x1:Perm xs ys][a:s][axs:list s][x2:Adjoin a xs axs][ays:list s][x3:Adjoin a ys ays]   Perm_elim C_Perm f_perm1 f_perm2 (perm1|s)  ==>  f_perm1|| Perm_elim C_Perm f_perm1 f_perm2 (perm2 xs ys x1 a axs x2 ays x3)  ==>  f_perm2 xs ys x1 a axs x2 ays x3 (Perm_elim C_Perm f_perm1 f_perm2 x1)]
;
[Perm_fact : {s|SET}{xs,ys|list s}{a|s}(Perm%%s xs ys)->Perm%%s (cons%%s a xs) (cons%%s a ys)
  = [s|SET][xs,ys|list s][a|s][H:Perm%%s xs ys]perm2%%s xs ys H a (cons%%s a xs) (ad1%%s a xs) (cons%%s a ys) (ad1%%s a ys)];
[Perm_refl : {s|SET}{xs:list s}Perm%%s xs xs
  = [s|SET][xs:list s]list_ind%%s ([xs'3:list s]Perm%%s xs'3 xs'3) (perm1%%s) ([x:s][l:list s][H:Perm%%s l l]perm2%%s l l H x (cons%%s x l) (ad1%%s x l) (cons%%s x l) (ad1%%s x l)) xs];
[Perm_sym : {s|SET}{xs,ys|list s}(Perm%%s xs ys)->Perm%%s ys xs
  = [s|SET][xs,ys|list s][H:Perm%%s xs ys]Perm_elim%%s ([xs'5,ys'6:list s]Perm%%s ys'6 xs'5) (perm1%%s) ([xs1,ys1:list s][x1:Perm%%s xs1 ys1][a:s][axs:list s][x2:Adjoin%%s a xs1 axs][ays:list s][x3:Adjoin%%s a ys1 ays][x1_ih:Perm%%s ys1 xs1]perm2%%s ys1 xs1 x1_ih a ays x3 axs x2)%%xs%%ys H];
[Perm_Adjoin_com1 : {s|SET}{a|s}{vs,xs,ys,zs|list s}(Perm%%s vs xs)->(Adjoin%%s a xs ys)->(Adjoin%%s a zs ys)->Perm%%s vs zs
  = [s|SET][a|s][vs,xs,ys,zs|list s][P1:Perm%%s vs xs]Perm_elim%%s ([vs'8,xs'9:list s]{ys'10,zs'11:list s}(Adjoin%%s a xs'9 ys'10)->(Adjoin%%s a zs'11 ys'10)->Perm%%s vs'8 zs'11) ([ys1,zs1:list s][H:Adjoin%%s a (nil s) ys1][H1:Adjoin%%s a zs1 ys1]Eq_subst%%(list s)%%(nil s)%%zs1 (Eq_sym%%(list s)%%zs1%%(nil s) (Adjoin_inv_corr5%%s%%a%%zs1 (Eq_subst%%(list s)%%ys1%%(cons%%s a (nil s)) (Adjoin_inv_corr3%%s%%a%%ys1 H) (Adjoin%%s a zs1) H1))) (Perm%%s (nil s)) (perm1%%s)) ([vs1,xs1:list s][P2:Perm%%s vs1 xs1][c:s][vs':list s][s1:Adjoin%%s c vs1 vs'][xs':list s][s2:Adjoin%%s c xs1 xs'][IH:{ys'16,zs'17:list s}(Adjoin%%s a xs1 ys'16)->(Adjoin%%s a zs'17 ys'16)->Perm%%s vs1 zs'17][ys',zs':list s][s3:Adjoin%%s a xs' ys'][s4:Adjoin%%s a zs' ys']Adjoin_com1%%s%%c%%a%%xs1%%ys'%%xs' s2 s3 (Perm%%s vs' zs') ([ys'':list s][H:Adjoin%%s a xs1 ys'' /\ Adjoin%%s c ys'' ys']H%%(Perm%%s vs' zs') ([H1:Adjoin%%s a xs1 ys''][H2:Adjoin%%s c ys'' ys']Adjoin_com3%%s%%c%%a%%ys''%%zs'%%ys' H2 s4%%(Perm%%s vs' zs') ([H3:Eq%%(list s) zs' ys'' /\ Eq%%s a c]H3%%(Perm%%s vs' zs') ([H4:Eq%%(list s) zs' ys''][H5:Eq%%s a c]Eq_subst%%(list s)%%ys''%%zs' (Eq_sym%%(list s)%%zs'%%ys'' H4) (Perm%%s vs') (perm2%%s vs1 xs1 P2 c vs' s1 ys'' (Eq_subst%%s%%a%%c H5 ([c'28:s]Adjoin%%s c'28 xs1 ys'') H1)))) ([H3:Ex%%(list s) ([zs'25:list s](Adjoin%%s a zs'25 ys'' /\ Adjoin%%s c zs'25 zs'))]H3 (Perm%%s vs' zs') ([zs'':list s][H4:Adjoin%%s a zs'' ys'' /\ Adjoin%%s c zs'' zs']H4%%(Perm%%s vs' zs') ([H5:Adjoin%%s a zs'' ys''][H6:Adjoin%%s c zs'' zs']perm2%%s vs1 zs'' (IH ys'' zs'' H1 H5) c vs' s1 zs' H6))))))%%vs%%xs P1 ys zs];
[Perm_Adjoin_com2 : {s|SET}{a|s}{xs,ys,zs,us|list s}(Adjoin%%s a xs ys)->(Perm%%s ys zs)->(Adjoin%%s a us zs)->Perm%%s xs us
  = [s|SET][a|s][xs,ys,zs,us|list s][H:Adjoin%%s a xs ys][H1:Perm%%s ys zs][H2:Adjoin%%s a us zs]Perm_elim%%s ([ys'10,zs'11:list s]{xs'12,us'13:list s}(Adjoin%%s a xs'12 ys'10)->(Adjoin%%s a us'13 zs'11)->Perm%%s xs'12 us'13) ([xs1,us1:list s][H3:Adjoin%%s a xs1 (nil s)][H4:Adjoin%%s a us1 (nil s)]Adjoin_inv_corr4%%s%%a%%us1 H4 (Perm%%s xs1 us1)) ([ys1,zs1:list s][P1:Perm%%s ys1 zs1][b:s][ys':list s][s1:Adjoin%%s b ys1 ys'][zs':list s][s2:Adjoin%%s b zs1 zs'][IH:{xs'18,us'19:list s}(Adjoin%%s a xs'18 ys1)->(Adjoin%%s a us'19 zs1)->Perm%%s xs'18 us'19][xs',us':list s][s3:Adjoin%%s a xs' ys'][s4:Adjoin%%s a us' zs']Adjoin_com3%%s%%b%%a%%ys1%%xs'%%ys' s1 s3%%(Perm%%s xs' us') ([H3:Eq%%(list s) xs' ys1 /\ Eq%%s a b]H3%%(Perm%%s xs' us') ([H4:Eq%%(list s) xs' ys1][H5:Eq%%s a b]Eq_subst%%(list s)%%ys1%%xs' (Eq_sym%%(list s)%%xs'%%ys1 H4) ([xs''26:list s]Perm%%s xs''26 us') (Perm_Adjoin_com1%%s%%b%%ys1%%zs1%%zs'%%us' P1 s2 (Eq_subst%%s%%a%%b H5 ([b'26:s]Adjoin%%s b'26 us' zs') s4)))) ([H3:Ex%%(list s) ([zs'23:list s](Adjoin%%s a zs'23 ys1 /\ Adjoin%%s b zs'23 xs'))]H3 (Perm%%s xs' us') ([xs1:list s][H4:Adjoin%%s a xs1 ys1 /\ Adjoin%%s b xs1 xs']H4%%(Perm%%s xs' us') ([H5:Adjoin%%s a xs1 ys1][H6:Adjoin%%s b xs1 xs']Adjoin_com3%%s%%b%%a%%zs1%%us'%%zs' s2 s4%%(Perm%%s xs' us') ([H7:Eq%%(list s) us' zs1 /\ Eq%%s a b]H7%%(Perm%%s xs' us') ([H8:Eq%%(list s) us' zs1][H9:Eq%%s a b]Eq_subst%%(list s)%%zs1%%us' (Eq_sym%%(list s)%%us'%%zs1 H8) (Perm%%s xs') (Perm_sym%%s%%zs1%%xs' (Perm_Adjoin_com1%%s%%b%%zs1%%ys1%%ys'%%xs' (Perm_sym%%s%%ys1%%zs1 P1) s1 (Eq_subst%%s%%a%%b H9 ([b'31:s]Adjoin%%s b'31 xs' ys') s3))))) ([H7:Ex%%(list s) ([zs'28:list s](Adjoin%%s a zs'28 zs1 /\ Adjoin%%s b zs'28 us'))]H7 (Perm%%s xs' us') ([us1:list s][H8:Adjoin%%s a us1 zs1 /\ Adjoin%%s b us1 us']H8%%(Perm%%s xs' us') ([H9:Adjoin%%s a us1 zs1][H10:Adjoin%%s b us1 us']perm2%%s xs1 us1 (IH xs1 us1 H5 H9) b xs' H6 us' H10)))))))%%ys%%zs H1 xs us H H2];
[Perm_Adjoin_com2_corr : {s|SET}{a|s}{xs,ys|list s}(Perm%%s (cons%%s a xs) (cons%%s a ys))->Perm%%s xs ys
  = [s|SET][a|s][xs,ys|list s][H:Perm%%s (cons%%s a xs) (cons%%s a ys)]Perm_Adjoin_com2%%s%%a%%xs%%(cons%%s a xs)%%(cons%%s a ys)%%ys (ad1%%s a xs) H (ad1%%s a ys)];
[Perm_Adjoin_com3 : {s|SET}{a|s}{xs,zs,ys|list s}(Adjoin%%s a xs ys)->(Perm%%s ys zs)->Ex%%(list s) ([us:list s](Perm%%s xs us /\ Adjoin%%s a us zs))
  = [s|SET][a|s][xs,zs,ys|list s][H:Adjoin%%s a xs ys][H1:Perm%%s ys zs]Perm_elim%%s ([ys'8,zs'9:list s]{xs'10:list s}(Adjoin%%s a xs'10 ys'8)->Ex%%(list s) ([us:list s](Perm%%s xs'10 us /\ Adjoin%%s a us zs'9))) ([xs1:list s][H2:Adjoin%%s a xs1 (nil s)]Adjoin_inv_corr4%%s%%a%%xs1 H2 (Ex%%(list s) ([us:list s](Perm%%s xs1 us /\ Adjoin%%s a us (nil s))))) ([ys1,zs1:list s][x1:Perm%%s ys1 zs1][b:s][ys':list s][s1:Adjoin%%s b ys1 ys'][zs':list s][s2:Adjoin%%s b zs1 zs'][IH:{xs'16:list s}(Adjoin%%s a xs'16 ys1)->Ex%%(list s) ([us:list s](Perm%%s xs'16 us /\ Adjoin%%s a us zs1))][xs':list s][s3:Adjoin%%s a xs' ys']Adjoin_com3%%s%%b%%a%%ys1%%xs'%%ys' s1 s3%%(Ex%%(list s) ([us:list s](Perm%%s xs' us /\ Adjoin%%s a us zs'))) ([H2:Eq%%(list s) xs' ys1 /\ Eq%%s a b]H2%%(Ex%%(list s) ([us:list s](Perm%%s xs' us /\ Adjoin%%s a us zs'))) ([H3:Eq%%(list s) xs' ys1][H4:Eq%%s a b]ExIntro%%(list s) zs1 ([us:list s](Perm%%s xs' us /\ Adjoin%%s a us zs')) (pair%%(Perm%%s xs' zs1)%%(Adjoin%%s a zs1 zs') (Eq_subst%%(list s)%%ys1%%xs' (Eq_sym%%(list s)%%xs'%%ys1 H3) ([z:list s]([xs''2:list s]Perm%%s xs''2 zs1) z) x1) (Eq_subst%%s%%b%%a (Eq_sym%%s%%a%%b H4) ([z:s]Adjoin%%s z zs1 zs') s2)))) ([H0:Ex%%(list s) ([zs'19:list s](Adjoin%%s a zs'19 ys1 /\ Adjoin%%s b zs'19 xs'))]H0 (Ex%%(list s) ([us:list s](Perm%%s xs' us /\ Adjoin%%s a us zs'))) ([xs1:list s][H2:Adjoin%%s a xs1 ys1 /\ Adjoin%%s b xs1 xs']H2%%(Ex%%(list s) ([us:list s](Perm%%s xs' us /\ Adjoin%%s a us zs'))) ([H3:Adjoin%%s a xs1 ys1][H4:Adjoin%%s b xs1 xs']IH xs1 H3 (Ex%%(list s) ([us:list s](Perm%%s xs' us /\ Adjoin%%s a us zs'))) ([us:list s][H5:Perm%%s xs1 us /\ Adjoin%%s a us zs1]H5%%(Ex%%(list s) ([us'26:list s](Perm%%s xs' us'26 /\ Adjoin%%s a us'26 zs'))) ([H6:Perm%%s xs1 us][H7:Adjoin%%s a us zs1]Adjoin_com1%%s%%a%%b%%us%%zs'%%zs1 H7 s2 (Ex%%(list s) ([us'28:list s](Perm%%s xs' us'28 /\ Adjoin%%s a us'28 zs'))) ([us':list s][H8:Adjoin%%s b us us' /\ Adjoin%%s a us' zs']H8%%(Ex%%(list s) ([us'30:list s](Perm%%s xs' us'30 /\ Adjoin%%s a us'30 zs'))) ([H9:Adjoin%%s b us us'][H10:Adjoin%%s a us' zs']ExIntro%%(list s) us' ([us'32:list s](Perm%%s xs' us'32 /\ Adjoin%%s a us'32 zs')) (pair%%(Perm%%s xs' us')%%(Adjoin%%s a us' zs') (perm2%%s xs1 us H6 b xs' H4 us' H9) H10)))))))))%%ys%%zs H1 xs H];
[Perm_trans : {s|SET}{xs,ys,zs|list s}(Perm%%s xs ys)->(Perm%%s ys zs)->Perm%%s xs zs
  = [s|SET][xs,ys,zs|list s][P1:Perm%%s xs ys]Perm_elim%%s ([xs'6,ys'7:list s]{zs'8:list s}(Perm%%s ys'7 zs'8)->Perm%%s xs'6 zs'8) ([zs1:list s][H:Perm%%s (nil s) zs1]H) ([xs1,ys1:list s][P2:Perm%%s xs1 ys1][a:s][xs':list s][s1:Adjoin%%s a xs1 xs'][ys':list s][s2:Adjoin%%s a ys1 ys'][IH:{zs'14:list s}(Perm%%s ys1 zs'14)->Perm%%s xs1 zs'14][zs':list s][P3:Perm%%s ys' zs']Perm_Adjoin_com3%%s%%a%%ys1%%zs'%%ys' s2 P3 (Perm%%s xs' zs') ([zs'':list s][H:Perm%%s ys1 zs'' /\ Adjoin%%s a zs'' zs']H%%(Perm%%s xs' zs') ([H1:Perm%%s ys1 zs''][H2:Adjoin%%s a zs'' zs']perm2%%s xs1 zs'' (IH zs'' H1) a xs' s1 zs' H2)))%%xs%%ys P1 zs];
[Perm_of_Distin : {s|SET}{xs,ys:list s}(Distin%%s xs)->({a:s}(Member%%s a xs)->Member%%s a ys)->(Eq%%nat (length%%s xs) (length%%s ys))->Perm%%s xs ys
  = [s|SET]list_ind%%s ([xs:list s]{ys:list s}(Distin%%s xs)->({a:s}(Member%%s a xs)->Member%%s a ys)->(Eq%%nat (length%%s xs) (length%%s ys))->Perm%%s xs ys) ([ys:list s][H:Distin%%s (nil s)][H1:{a:s}(Member%%s a (nil s))->Member%%s a ys][H2:Eq%%nat (length%%s (nil s)) (length%%s ys)]Eq_subst%%(list s)%%(nil s)%%ys (Eq_sym%%(list s)%%ys%%(nil s) (length_zero_nil%%s ys (Eq_sym%%nat%%(length%%s (nil s))%%(length%%s ys) H2))) ([z:list s]Perm%%s (nil s) z) (perm1%%s)) ([x:s][l:list s][H:{ys:list s}(Distin%%s l)->({a:s}(Member%%s a l)->Member%%s a ys)->(Eq%%nat (length%%s l) (length%%s ys))->Perm%%s l ys][ys:list s][H1:Distin%%s (cons%%s x l)][H2:{a:s}(Member%%s a (cons%%s x l))->Member%%s a ys][H3:Eq%%nat (length%%s (cons%%s x l)) (length%%s ys)]H2 x (ExIntro%%(list s) l ([ys'9:list s]Adjoin%%s x ys'9 (cons%%s x l)) (ad1%%s x l)) (Perm%%s (cons%%s x l) ys) ([t:list s][H4:Adjoin%%s x t ys]perm2%%s l t (H t (snd%%(not (Member%%s x l))%%(Distin%%s l) (Distin_inv%%s%%x%%l H1)) ([b:s][H5:Member%%s b l]Member_Adjoin%%s%%t%%ys%%x%%b ([H6:Eq%%s x b]fst%%(not (Member%%s x l))%%(Distin%%s l) (Distin_inv%%s%%x%%l H1) (Eq_subst%%s%%b%%x (Eq_sym%%s%%x%%b H6) ([z:s]Member%%s z l) H5)) H4 (H2 b (snd%%((Member%%s b (cons%%s x l))->(Member%%s b l \/ Eq%%s x b))%%((Member%%s b l \/ Eq%%s x b)->Member%%s b (cons%%s x l)) (Mem_ind|s|l|x|b) (inl%%(Member%%s b l)%%(Eq%%s x b) H5)))) (Eq_resp%%nat%%nat pred|(length%%s (cons%%s x l))|(suc (length%%s t)) (Eq_subst%%nat%%(length%%s ys)%%(length%%s (cons%%s x l)) (Eq_sym%%nat%%(length%%s (cons%%s x l))%%(length%%s ys) H3) ([z:nat]Eq%%nat z (suc (length%%s t))) (Adjoin_length_suc%%s%%x%%t%%ys H4)))) x (cons%%s x l) (ad1%%s x l) ys H4))];
[surjective_imp_Perm : {s|SET}{l:list s}{f,g:s->s}(Distin%%s l)->({x:s}(Member%%s x l)->Member%%s (g x) l)->({x:s}Eq%%s (f (g x)) x)->Perm%%s l (map%%s%%s f l)
  = [s|SET][l:list s][f,g:s->s][H:Distin%%s l][H1:{x:s}(Member%%s x l)->Member%%s (g x) l][H2:{x:s}Eq%%s (f (g x)) x]Perm_of_Distin%%s l (map%%s%%s f l) H ([a:s][H3:Member%%s a l]Eq_subst%%s%%(f (g a))%%a (Eq_sym%%s%%a%%(f (g a)) (Eq_sym%%s%%(f (g a))%%a (H2 a))) ([z:s]Member%%s z (map%%s%%s f l)) (Member_map%%s%%s l (g a) f (H1 a H3))) (Eq_sym%%nat%%(length%%s (map%%s%%s f l))%%(length%%s l) (length_map%%s%%s l f))];
