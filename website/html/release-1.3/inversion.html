<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>LEGO Version 1.3: Inversion and Invert</title>
  </head>

  <body>
<P>
 <HR> 
<A HREF="qnify.html">
<IMG ALIGN=MIDDLE
SRC="http://www.dcs.ed.ac.uk/icons//next_motif.gif"></A> 

<A HREF="newfeatures.html"> 
<IMG ALIGN=MIDDLE SRC="http://www.dcs.ed.ac.uk/icons//up_motif.gif"></A>

<A HREF="infix.html">
<IMG ALIGN=MIDDLE
SRC="http://www.dcs.ed.ac.uk/icons//previous_motif.gif"></A>

<A HREF="../index.html"><IMG ALIGN=MIDDLE SRC="http://www.dcs.ed.ac.uk/icons//contents_motif.gif"></A>
 <BR>

<B> Next:</B> <A  HREF="qnify.html">qnify, Qnify and Configure Qnify</A>
<B> Up:</B> <A  HREF="newfeatures.html">New features in LEGO Version 1.3:</A>
<B> Previous:</B> <A HREF="infix.html">Infix Notation</A>
<HR>        <h1>LEGO Version 1.3: Inversion and Invert</h1>

Consider a typical inductively defined relation:
<P>
<PRE>
  Inductive [R:T1->..->Tn->UNIV] Relation
  Constructors
    [rule1 : {x1:t1}..{xk:tk} (* schematic variables *)

                (* inductive premises *)
            (R p1 .. pn)->..->(R p'1 .. p'n)->       (* side conditions *)
        (*--------------------------------------*) S1->..->Sn->
                     R c1 .. cn
                  (* conclusion *)                               ]
    (* more rules *)
    [ruleN: (* same pattern *) ];
</PRE>
<P>

Suppose we have a hypothesis
<P><PRE>
  H : R a1 .. an
</PRE><P>

To <b>invert</b> <tt>H</tt> is to observe that it must have been
derived by some constructor of <tt>R</tt>. That is, for some rule, it
must be the case that the schematic variables have values for which
the premises and side conditions hold and <tt>R a1 .. an</tt>
unifies with <tt>R c1 .. cn</tt>, ie <tt>a1 = c1</tt> .. <tt>an = cn</tt>.
<P>

Adding the <b>Inversion</b> switch to such an inductive family
<tt>R</tt> (whether defined with Relation set or not) causes LEGO to
prove and store a generic inversion theorem, <tt>R_inversion</tt> for
that family, after the fashion of Clark's <b>completion</b>.  (Note
that type dependencies within the parameters of <tt>R</tt> will make
the equalities ill-typed. In such cases, the user is informed and no
inversion theorem is generated, but the rest of the definiiton goes
through.)
<P>
Having established this theorem, we may now use the <b>Invert</b>
tactic to apply it to hypothetical inhabitants of the relation. The
goal will then be split into a case for each constructor of the relation
conditional on the relevant premises, side conditions and equalities.
<P>
For example, if we have defined less-than-or-equals inductively with
<P>
<PRE>
  Inductive [le:nat->nat->Prop] Relation Inversion
  Constructors
    [le0:{n:nat}le zero n]
    [leS:{m,n|nat}(le m n)->le (suc m) (suc n)];
</PRE>
<P>
and our current proof state is
<P><PRE>
  H : le m zero
    ?1 : Eq m zero
</PRE><P>
then we can invert <tt>H</tt> as follows
<P><PRE>
  Lego> Invert H;
  Refine by  le_inversion H
     ?3 : (Eq zero m)->{a1:nat}(Eq a1 zero)->Eq m zero
     ?4 : {a3:nat}(Eq (suc a3) m)->{a2:nat}(Eq (suc a2) zero)->(le a3 a2)->
          Eq m zero
</PRE><P>

Observe that the schematic variables, premises and side conditions
from each constructor have become the premises of the corresponding
subgoal, together with the equations which comprise the claim that
<tt>le m zero</tt> unifies with the conclusion of the constructor.
<P>

The new tactic <A HREF="qnify.html"><b>qnify</b></a> attacks
unification problems expressed as equational premises in the
goal. Note that the equations have been deliberately shifted as far
left as their dependencies permit in order to maximise the scope of
any substitutions qnify might apply.
<P>

The new <A HREF="then.html"><b>Then</b></a> tactical can be used to
instruct Lego to qnify each subgoal generated by Invert. Indeed the
goal <tt>?1</tt> can be proven in one stroke:
<P><PRE>
  H : le m zero
    ?1 : Eq m zero
  Lego> Invert H Then qnify Then Refine Eq_refl;
    (* machine effort *)
  *** QED ***
</PRE>
<P>
Note that the <b>Inversion</b> package uses the equality registered by
<A HREF="config_eq.html"><b>Configure Equality</b></a>. Also, mutually
inductive relations are not yet supported by this feature.
</body>
</html>